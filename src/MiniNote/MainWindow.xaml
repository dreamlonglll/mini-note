<Window x:Class="MiniNote.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:views="clr-namespace:MiniNote.Views"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        Title="MiniNote"
        Width="360"
        Height="520"
        MinWidth="320"
        MinHeight="380"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        ResizeMode="CanResizeWithGrip"
        ShowInTaskbar="False"
        Topmost="True"
        MouseLeftButtonDown="Window_MouseLeftButtonDown"
        Loaded="Window_Loaded"
        Closing="Window_Closing">

    <Border x:Name="MainBorder"
            CornerRadius="16"
            BorderBrush="{DynamicResource AppBorderBrush}"
            BorderThickness="1"
            Background="{DynamicResource AppBackgroundBrush}">
        <Border.Effect>
            <DropShadowEffect BlurRadius="28" ShadowDepth="8" Color="#000000" Opacity="0.4"/>
        </Border.Effect>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="52"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- 顶部强调线 -->
            <Border Grid.RowSpan="3"
                    Height="3"
                    Background="{DynamicResource AccentBrush}"
                    VerticalAlignment="Top"
                    Opacity="0.95"/>

            <!-- 标题栏 -->
            <Border Grid.Row="0"
                    Background="{DynamicResource SurfaceBrush}"
                    CornerRadius="16,16,0,0">
                <Grid>
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="18,0,0,0">
                        <Ellipse Width="10"
                                 Height="10"
                                 Fill="{DynamicResource AccentBrush}"
                                 VerticalAlignment="Center"
                                 Margin="0,0,10,0"/>
                        <TextBlock Text="MiniNote"
                                   Foreground="{DynamicResource TextPrimaryBrush}"
                                   FontWeight="SemiBold"
                                   FontSize="16"/>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal"
                                HorizontalAlignment="Right"
                                Margin="0,0,8,0">
                        <Button x:Name="BtnSettings"
                                ToolTip="设置"
                                Style="{StaticResource TitleBarButtonStyle}"
                                Click="BtnSettings_Click">
                            <materialDesign:PackIcon Kind="Cog" Width="16" Height="16"/>
                        </Button>
                        <Button x:Name="BtnPin"
                                ToolTip="嵌入桌面"
                                Style="{StaticResource TitleBarButtonStyle}"
                                Click="BtnPin_Click">
                            <materialDesign:PackIcon x:Name="IconPin" Kind="PinOutline" Width="16" Height="16"/>
                        </Button>
                        <Button x:Name="BtnMinimize"
                                ToolTip="最小化"
                                Style="{StaticResource TitleBarButtonStyle}"
                                Click="BtnMinimize_Click">
                            <materialDesign:PackIcon Kind="WindowMinimize" Width="16" Height="16"/>
                        </Button>
                        <Button x:Name="BtnClose"
                                ToolTip="关闭"
                                Style="{StaticResource CloseButtonStyle}"
                                Click="BtnClose_Click">
                            <materialDesign:PackIcon Kind="Close" Width="16" Height="16"/>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- 待办列表 -->
            <ScrollViewer Grid.Row="1"
                          Margin="14,8,14,0"
                          VerticalScrollBarVisibility="Auto"
                          HorizontalScrollBarVisibility="Disabled">
                <ItemsControl ItemsSource="{Binding TodoItems}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <views:TodoItemView DataContext="{Binding}"/>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>

            <!-- 空状态提示 - 只在没有待办项时显示 -->
            <StackPanel Grid.Row="1"
                        VerticalAlignment="Center"
                        HorizontalAlignment="Center"
                        Visibility="{Binding TotalCount, Converter={StaticResource ZeroToVisibleConverter}}">
                <materialDesign:PackIcon Kind="ClipboardTextOutline"
                                         Width="48" Height="48"
                                         Foreground="#30FFFFFF"
                                         HorizontalAlignment="Center"/>
                <TextBlock Text="暂无待办事项"
                           Foreground="{DynamicResource TextSecondaryBrush}"
                           FontSize="14"
                           HorizontalAlignment="Center"
                           Margin="0,14,0,0"/>
                <TextBlock Text="点击下方按钮添加"
                           Foreground="{DynamicResource TextTertiaryBrush}"
                           FontSize="12"
                           HorizontalAlignment="Center"
                           Margin="0,4,0,0"/>
            </StackPanel>

            <!-- 悬浮添加按钮 - 固定模式下隐藏 -->
            <Button x:Name="BtnAddFloat"
                    Grid.Row="1"
                    Style="{StaticResource FloatingAddButtonStyle}"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Bottom"
                    Margin="0,0,18,18"
                    ToolTip="添加待办"
                    Click="BtnAddFloat_Click">
                <materialDesign:PackIcon Kind="Plus"
                                         Width="24" Height="24"
                                         Foreground="White"/>
            </Button>

            <!-- 底部统计 -->
            <Border Grid.Row="2"
                    Background="{DynamicResource DividerBrush}"
                    CornerRadius="0,0,16,16"
                    Padding="18,12">
                <Grid>
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <materialDesign:PackIcon Kind="CheckCircleOutline"
                                                 Width="14" Height="14"
                                                 Foreground="{DynamicResource TextTertiaryBrush}"
                                                 VerticalAlignment="Center"
                                                 Margin="0,0,6,0"/>
                        <TextBlock Foreground="{DynamicResource TextTertiaryBrush}" FontSize="12">
                            <Run Text="已完成"/>
                        </TextBlock>
                        <TextBlock Foreground="{DynamicResource TextPrimaryBrush}" FontSize="12" FontWeight="SemiBold" Margin="6,0,0,0">
                            <Run Text="{Binding CompletedCount, Mode=OneWay}"/>
                        </TextBlock>
                        <TextBlock Foreground="{DynamicResource TextTertiaryBrush}" FontSize="12" Margin="4,0">
                            <Run Text="/"/>
                        </TextBlock>
                        <TextBlock Foreground="{DynamicResource TextSecondaryBrush}" FontSize="12">
                            <Run Text="{Binding TotalCount, Mode=OneWay}"/>
                        </TextBlock>
                    </StackPanel>

                    <Button Content="清除已完成"
                            HorizontalAlignment="Right"
                            Foreground="#FF6B6B"
                            Background="Transparent"
                            BorderThickness="0"
                            FontSize="12"
                            Cursor="Hand"
                            Command="{Binding ClearCompletedCommand}"
                            Visibility="{Binding CompletedCount, Converter={StaticResource ZeroToCollapsedConverter}}">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Foreground" Value="#FF5252"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>
                </Grid>
            </Border>
        </Grid>
    </Border>
</Window>
